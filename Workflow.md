# Как работать над проектом

## Окружение

Для удобства работы над проектом используются инструменты из **Node.js** и **npm**. Все необходимые настройки произведены. Убедитесь, что на рабочем компьютере установлен актуальный LTS релиз Node.js**. Актуальная версия **Node.js** указана в файле `package.json` в поле `node`. Затем, в терминале, перейдите в директорию с проектом и _единожды_ запустите команду:

```bash
npm install
```

Команда запустит процесс установки зависимостей проекта из **npm**.

## Переменные окружения

Переменные окружения читаются из `.env` (см. `.env.example`). Формат описания ниже: `PARAM=value` — описание.

- `PORT=4000` — порт REST API сервера.
- `DB_HOST=127.0.0.1` — хост MongoDB.
- `DB_PORT=27017` — порт MongoDB.
- `DB_NAME=six-cities` — имя базы данных.
- `DB_USER=admin` — логин администратора MongoDB.
- `DB_PASSWORD=admin` — пароль администратора MongoDB.
- `SALT=...` — соль для хеширования паролей.
- `DEFAULT_USER_PASSWORD=...` — пароль по умолчанию для пользователей, создаваемых при CLI-импорте TSV.
- `UPLOAD_DIRECTORY=upload` — директория для загружаемых файлов (аватары и т.п.).
- `JWT_SECRET=...` — секрет для подписи JWT.
- `JWT_EXPIRES_IN=2d` — срок жизни JWT (например: `2d`, `12h`, `60m`).

## Запуск проекта

1) Поднимите MongoDB (вариант через Docker):

```bash
docker compose -f docker-compose.yml up -d
```

2) Создайте локальный `.env` на основе `.env.example` и при необходимости поправьте значения.

3) Запустите REST API:

```bash
npm run start:rest
```

### Сценарии

В `package.json` предопределено несколько сценариев.

#### Скомпилировать проект

```bash
npm run compile
```

Создаст директорию `dist` и скомпилирует проект.

#### Удалить скомпилированный проект

```bash
npm run clean
```

Удаляет директорию `dist`. Используется перед компиляцией.

#### Собрать проект

```bash
npm run build
```

Выполняет сборку проекта: удаляет ранее скомпилированный проект и компилирует заново.

#### Проверить линтером

```bash
npm run lint
```

Запуск проверки проекта статическим анализатором кода **ESLint**.

Линтер проверяет файлы только внутри директории `src`.

**Обратите внимание**, при запуске данной команды, ошибки выводятся в терминал.

#### Запустить ts-модуль без компиляции

```bash
npm run ts -- <Путь к модулю с ts-кодом>
```

Пакет `ts-node` позволяет выполнить TS-код в Node.js без предварительной компиляции. Используется только на этапе разработки.

#### Запустить проект

```bash
npm start
```

В процессе запуска проекта будет выполнен процесс «Сборки проекта» и запуска результирующего кода.

#### Запустить REST API с красивыми логами

```bash
npm run start:rest
```

Собирает проект и запускает REST API, форматируя логи через `pino-pretty`.

#### Запустить CLI

```bash
npm run cli -- --help
```

Запускает CLI (ts-node). Команды: `--help`, `--version`, `--generate`, `--import`.

#### Сгенерировать тестовые данные (CLI)

```bash
npm run cli:generate
```

Генерирует TSV с предложениями.

#### Импортировать данные в MongoDB (CLI)

```bash
npm run cli:import-db
```

Импортирует TSV в MongoDB. Параметры подключения берутся из `.env`.

#### Запуск JSON-сервера

```bash
npm run mock:server
```

Запускает cервер с данными из файла `mocks/mock-server-data.json` по адресу http://localhost:3123.

## Структура проекта

### Директория `src`

Исходный код проекта: компоненты, модули и так далее. Структура директории `src` может быть произвольной.

### Файл `Readme.md`

Инструкции по работе с учебным репозиторием.

### Файл `Contributing.md`

Советы и инструкции по внесению изменений в учебный репозиторий.

### Остальное

Все остальные файлы в проекте являются служебными. Пожалуйста, не удаляйте и не изменяйте их самовольно. Только если того требует задание или наставник.
